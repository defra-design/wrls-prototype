<dl class="govuk-summary-list">

  {% if data.licences[data.ID].name.length %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Licence name
    </dt>
    <dd class="govuk-summary-list__value">

      {{[data.licences[data.ID].name]}}
    </dd>

  </div>
 {% endif %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Licence holder
    </dt>
    <dd class="govuk-summary-list__value">
      {{[data.licences[data.ID].holder]}}

      <!-- matching the licence holder name with the customer record -->
      <!-- and returning the customerID to be used in the link       -->
      {% set loopNumber = "" %}
      {% for i in data['customers'] %}
        {% if [data.licences[data.ID].holder] == data.customers[loop.index0]['name'] %}
          {% set loopNumber = loop.index0 %}
        {% endif %}
      {% endfor %}

      <br>
      <!-- TODO create a new as at licence-contact page on live -->
      <!-- in card boxes with primary user and returns agents   -->
      <a class="govuk-link" href="customer?customerID={{loopNumber}}">View contact details</a>
    </dd>

  </div>

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Effective from
    </dt>
    <dd class="govuk-summary-list__value">
      {{[data.licences[data.ID].effectiveDate]}}
    </dd>

  </div>

  {% if data.licences[data.ID].endDate.length %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      End date
    </dt>
    <dd class="govuk-summary-list__value">
      {{[data.licences[data.ID].endDate]}}
    </dd>

  </div>
  {% endif %}

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Source of supply
    </dt>
    <dd class="govuk-summary-list__value">
      {{[data.licences[data.ID].source]}}
    </dd>

  </div>

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Purpose
    </dt>
    <dd class="govuk-summary-list__value">
      {% set purpose %}
      {{data.licences[data.ID].purpose | dump | stripQuotes | stripSqBrackets | replaceComma | striptags(true) | escape | nl2br}}
      {% endset %}
      {{purpose|safe}}
    </dd>

  </div>

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Period of {% if 'Impounding' in purpose %}impoundment{% else %}abstraction{% endif %}
    </dt>
    <dd class="govuk-summary-list__value">
      {% for i in data.licences[data.ID]['absPeriod'] %}
      {{i}}<br>
      {% endfor %}
      {% if 'Impounding' not in purpose %}<a href="licence/abstraction-details">View details of your purpose, period and amounts</a>{% endif %}
    </dd>

  </div>

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Points of {% if 'Impounding' in purpose %}impoundment{% else %}abstraction{% endif %}
    </dt>
    <dd class="govuk-summary-list__value">
      {% for i in data.licences[data.ID]['absPoints'] %}
      {{i}}<br>
      {% endfor %}
      <a href="licence/points" >View details of {% if 'Impounding' in purpose %}impoundment{% else %}abstraction{% endif %} points</a>
    </dd>

  </div>



  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Monitoring station
    </dt>
    <dd class="govuk-summary-list__value">

      <!--set station ID to blank-->
      {% set stationID = "" %}
      {% set stationMatch = "false" %}
      <!--loop through stations-->
      {% set stations = data['stations'] %}
      {% for station in stations %}

      <!--set station number and name-->
      {% set stationID = loop.index0 %}
      {% set stationName = station.label %}
      {% set catchmentName = station.catchmentName %}

      <!--loop through the station tags-->
      {% set tags = data.stations[stationID]['tags'] %}
      {% for tag in tags %}

      <!--set tag number-->
      {% set tagNumber = loop.index0 %}
      {% set tagLicenceNumber = station.tags[tagNumber]['licenceNumber'] %}


      <!--check for licence number matches-->
      {% if tagLicenceNumber == data.licences[data.ID].number %}


      <a href="station?stationID={{stationID}}" class="govuk-link">
      {{stationName}}</a>

      {% set stationMatch = "true" %}

      {% endif %}
      {% endfor %}
      {% endfor %}

      {% if stationMatch == "false" %}
      <p class="govuk-body">This licence is not tagged with a station
<br>
      <a href="search?search=Monitoring%20stations" class="govuk-link">Search for a monitoring station and tag this licence</a></p>
      {% endif %}
    </dd>

  </div>



  <div class="govuk-summary-list__row   {% if data.licences[data.ID]['absQuantities'].length %}{% else %}govuk-summary-list__row--last{% endif %}">
    <dt class="govuk-summary-list__key">
      {% if 'Impounding' in purpose %}Impoundment{% else %}Abstraction{% endif %} conditions
    </dt>
    <dd class="govuk-summary-list__value">
      {% for i in data.licences[data.ID]['absConditions'] %}
      {{i.type|default("general condition")|capitalize | bracketsToUpperCase}}<br>
      {% endfor %}<a href="licence/conditions?ID={{data.ID}}">View details of {% if 'Impounding' in purpose %}impoundment{% else %}abstraction{% endif %} conditions</a>
    </dd>

  </div>

  {% if data.licences[data.ID]['absQuantities'].length %}
  <div class="govuk-summary-list__row govuk-summary-list__row--last">
    <dt class="govuk-summary-list__key">
      {% if 'Impounding' in purpose %}Impoundment{% else %}Abstraction{% endif %} amounts
    </dt>
    <dd class="govuk-summary-list__value">
      
      {{data.licences[data.ID]['absQuantities'] | replaceTilde | striptags(true) | escape | nl2br}}
    </dd>

    <!-- note TODO if >1 set of amounts, we would no longer list each set of them, -->
    <!-- just link through to purpose/period/amounts page - as it is on Live  - -  -->

  </div>
  {% endif %}


  {% if data.licences[data.ID]['billingRegion'].length %}
  <div class="govuk-summary-list__row govuk-summary-list__row--last">
    <dt class="govuk-summary-list__key">
      Billing region
    </dt>
    <dd class="govuk-summary-list__value">
      {{data.licences[data.ID]['billingRegion']}}
    </dd>
  </div>
  {% endif %}

</dl>


<!-- hide these elements for INTERNAL USERS as not relevant -->
<!--
{% include "sandbox/_includes/licence/inset-does-not-replace-paper-licence.html" %}

{% include "sandbox/_includes/licence/details-is-your-licence-information-correct.html" %}
-->

