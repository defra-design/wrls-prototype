<!--setting the loop number to 0-->
{% set loopNumber = "" %}

<!--getting the licence data-->
{% set numberContacts = 0 %}


    <!--set the customer page we are on--> 
    {% set customer = data.customers[data.customerID].name %}
<!--getting the contacts data-->
{% set contacts = data['contacts'] %}

<!--loop through each contact-->
{% for contact in contacts %}

{% if contact.type == "company" %}
{% else %}
<!--set the contact ID -->
{% set loopNumber = loop.index0 %}
<!--get the customers for each contact-->
{% set contactCustomers = data.contacts[loopNumber]['customers'] %}
<!--loop through each customers contacts-->
{% for contactCustomer in contactCustomers %}
<!--if the customer name for the contact matches the customer page we are on set the customer index number-->
{% if customer == contactCustomer['customer'] %}

{% set numberContacts = numberContacts + 1 %}

 {% endif %}
  {% endfor %}
    {% endif %}
  {% endfor %}


<table class="govuk-table">
  <caption class="govuk-table__caption">Showing all contacts</caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Name</th>
      <th scope="col" class="govuk-table__header">Communication type</th>
      <th scope="col" class="govuk-table__header">Email address</th>
      
  <!--    <th scope="col" class="govuk-table__header">Role</th>
      <th scope="col" class="govuk-table__header">Notices</th>-->
 <!-- if the customer is receiving email WAA show this column -->{# {% if data.customers[data.customerID].WAA == "email" %}  <th scope="col" class="govuk-table__header">Water abstraction alerts</th> {% endif %} #}
      <th scope="col" class="govuk-table__header">Action</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">

    <!--set the customer page we are on-->
    {% set customer = data.customers[data.customerID].name %}

<!--getting the contacts data-->
{% set contacts = data['contacts'] %}

<!--loop through each contact-->
{% for contact in contacts %}

{% if contact.type == "company" %}
{% else %}
<!--set the contact ID -->
{% set loopNumber = loop.index0 %}
<!--get the customers for each contact-->
{% set contactCustomers = data.contacts[loopNumber]['customers'] %}
<!--loop through each customers contacts-->
{% for contactCustomer in contactCustomers %}
<!--if the customer name for the contact matches the customer page we are on set the customer index number-->
{% if customer == contactCustomer['customer'] %}



{% set index = loop.index0 %}

  <tr class="govuk-table__row">
    <td class="govuk-table__cell">{{[data.contacts[loopNumber].name]}}</td>
    <td class="govuk-table__cell">{{contactCustomer.notices[0].type | default('Additional contact')}}</td>
    <td class="govuk-table__cell">{{[data.contacts[loopNumber].email]}}</td>
    <td class="govuk-table__cell">
      <ul class="govuk-summary-list__actions-list">
        <li class="govuk-summary-list__actions-list-item">
      <a href="manage-contact?contactID={{[loopNumber]}}&customerID={{data.customerID}}" class="govuk-link">Manage<span class="govuk-visually-hidden"> contacts notices</span></a>
    </li>

</ul>
    </td>

  </tr>
  {% endif %}
  {% endfor %}
    {% endif %}
  {% endfor %}




  </tbody>
</table>
